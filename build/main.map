{"version":3,"sources":["webpack:///webpack/bootstrap 893e1d4e0f203c8ccad4","webpack:///external \"koa-router\"","webpack:///./src/db/methods.js","webpack:///external \"mongoose\"","webpack:///external \"dotenv\"","webpack:///external \"koa\"","webpack:///external \"path\"","webpack:///external \"jwt-koa\"","webpack:///external \"bluebird\"","webpack:///external \"koa-bodyparser\"","webpack:///./src/index.js","webpack:///external \"@koa/cors\"","webpack:///external \"koa-favicon\"","webpack:///./src/router/index.js","webpack:///external \"koa-combine-routers\"","webpack:///./src/router/root.js","webpack:///external \"bcrypt-nodejs\"","webpack:///./src/models/index.js","webpack:///./src/models/message.js","webpack:///./src/models/user.js","webpack:///./src/router/auth.js","webpack:///./src/router/messages.js","webpack:///./src/utils/start.js","webpack:///./src/db/index.js","webpack:///external \"koa-mount\"","webpack:///./src/utils/serveFront.js","webpack:///external \"koa-static\"","webpack:///external \"koa-send\""],"names":["check","details","User","findOne","register","data","username","then","res","email","res2","user","name","age","gender","image","salt","bcrypt","genSaltSync","password","hashSync","save","token","createToken","success","error","field","message","login","passCheck","compareSync","sendMessage","Promise","resolve","reject","to","Message","findOneAndUpdate","$push","messages","new","safe","upsert","err","getMessages","fb","fbid","require","config","app","api","start","use","favicon","path","cors","mount","router","combine","root","get","jwtKoa","middleware","ctx","body","params","notFound","id","_id","mongoose","MessageSchema","type","String","required","Array","model","UserSchema","index","unique","Number","auth","post","koaBody","request","response","bodyParser","catch","e","patch","PORT","HOST","process","env","startDb","listen","console","log","DB_USER","DB_USER_PASS","DB_HOST","DB_PORT","DB_NAME","connect","front","serve","routes","allowedMethods","url","send"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 893e1d4e0f203c8ccad4","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 0\n// module chunks = 0","// @flow\r\nimport type { UserType } from '../types.flow';\r\nimport bcrypt from 'bcrypt-nodejs';\r\nimport { createToken } from 'jwt-koa';\r\nimport { User, Message } from '../models/index.js';\r\nimport type { MessageType } from '../types.flow';\r\n\r\nexport async function check(details: { username?: string, email?: string }) {\r\n    return User.findOne(details);\r\n}\r\n\r\nexport async function register(data: UserType) {\r\n    return check({ username: data.username }).then((res) => {\r\n        if (res === null) {\r\n            return check({ email: data.email }).then(async (res2) => {\r\n                if (res2 === null) {\r\n                    const user = new User({\r\n                        username: data.username,\r\n                        name: data.name,\r\n                        age: data.age,\r\n                        email: data.email,\r\n                        gender: data.gender,\r\n                    });\r\n                    user.image =\r\n                        data.image === ''\r\n                            ? '/uploads/user-default.png'\r\n                            : data.image;\r\n\r\n                    const salt: string = bcrypt.genSaltSync(10);\r\n                    user.password = bcrypt.hashSync(data.password, salt);\r\n                    return user.save().then((user) => {\r\n                        const token = createToken({ user }, '10m');\r\n                        return { success: true, user, token };\r\n                    });\r\n                } else {\r\n                    return {\r\n                        success: false,\r\n                        error: {\r\n                            field: 'email',\r\n                            message: 'Email registred!',\r\n                        },\r\n                    };\r\n                }\r\n            });\r\n        } else {\r\n            return {\r\n                success: false,\r\n                error: { field: 'username', message: 'Username taken!' },\r\n            };\r\n        }\r\n    });\r\n}\r\n\r\nexport async function login(data: { username: string, password: string }) {\r\n    return check({ username: data.username }).then((user) => {\r\n        if (user === null) {\r\n            return {\r\n                success: false,\r\n                error: { field: 'username', message: 'User not found!' },\r\n            };\r\n        } else {\r\n            const passCheck = bcrypt.compareSync(data.password, user.password);\r\n            if (passCheck === true) {\r\n                const token = createToken({ user }, '10m');\r\n                return { success: true, user, token };\r\n            } else {\r\n                return {\r\n                    success: false,\r\n                    error: { field: 'password', message: 'Wrong password!' },\r\n                };\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nexport function sendMessage(data: MessageType): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n        check({ username: data.to.username }).then((user) => {\r\n            if (user === null) {\r\n                reject({\r\n                    success: false,\r\n                    error: { field: 'user', message: 'Wrong password!' },\r\n                });\r\n            } else {\r\n                Message.findOneAndUpdate(\r\n                    { user: data.to },\r\n                    {\r\n                        $push: { messages: data.message },\r\n                    },\r\n                    { new: true, safe: true, upsert: true },\r\n                    (err, res) => {\r\n                        if (err) {\r\n                            reject({\r\n                                success: false,\r\n                                message: 'Message isn\\'t sent!',\r\n                            });\r\n                        }\r\n                        resolve({ success: true, res });\r\n                    }\r\n                );\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nexport async function getMessages(user: { id: string, username: string }) {\r\n    return Message.findOne({ user });\r\n}\r\n\r\nexport async function fb(data: UserType) {\r\n    return check({ fbid: data.fbid }).then((res) => {\r\n        if (res === null) {\r\n            // REGISTER\r\n            const user = new User({\r\n                username: data.username,\r\n                name: data.name,\r\n                email: data.email,\r\n                gender: data.gender,\r\n                fbid: data.fbid,\r\n                image: data.image,\r\n            });\r\n            return user.save().then((user) => {\r\n                const token = createToken({ user }, '10m');\r\n                return { success: true, user, token };\r\n            });\r\n        } else {\r\n            // LOGIN\r\n            const token = createToken({ user: res }, '10m');\r\n            return { success: true, user: res, token };\r\n        }\r\n    });\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/db/methods.js","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"jwt-koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jwt-koa\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"bluebird\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bluebird\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 8\n// module chunks = 0","// @flow\r\nimport Koa from 'koa';\r\nimport path from 'path';\r\nimport cors from '@koa/cors';\r\nimport favicon from 'koa-favicon';\r\nimport router from './router';\r\nimport start from './utils/start';\r\nimport mount from 'koa-mount';\r\nimport front from './utils/serveFront';\r\n\r\nif (process.env.NODE_ENV !== 'production') require('dotenv').config();\r\n\r\nconst app = new Koa();\r\nconst api = new Koa();\r\n\r\nstart(app);\r\napp.use(favicon(path.resolve('static/favicon.ico')));\r\napi.use(cors('*'));\r\napi.use(router);\r\n\r\napp.use(mount('/api', api));\r\napp.use(mount('/', front));\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"@koa/cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@koa/cors\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"koa-favicon\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-favicon\"\n// module id = 12\n// module chunks = 0","import combine from 'koa-combine-routers';\r\nimport root from './root';\r\nimport auth from './auth';\r\nimport messages from './messages';\r\n\r\nconst router = combine([root, messages, auth]);\r\n\r\nexport default router;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/router/index.js","module.exports = require(\"koa-combine-routers\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-combine-routers\"\n// module id = 14\n// module chunks = 0","import Router from 'koa-router';\r\nimport jwtKoa from 'jwt-koa';\r\n\r\nimport { check } from '../db/methods';\r\n\r\nconst root = new Router();\r\n\r\nroot.get('/check', jwtKoa.middleware, (ctx) => {\r\n    ctx.body = 'SECRET';\r\n});\r\nroot.get('/user/:username', async (ctx) => {\r\n    const { username } = ctx.params;\r\n    const user = await check({ username });\r\n    if (user == null) {\r\n        ctx.body = {\r\n            success: true,\r\n            notFound: true,\r\n            message: 'User not found',\r\n        };\r\n    } else {\r\n        ctx.body = {\r\n            success: true,\r\n            notFound: false,\r\n            id: user._id,\r\n            username: user.username,\r\n            image: user.image,\r\n            name: user.name,\r\n            gender: user.gender,\r\n            age: user.age,\r\n        };\r\n    }\r\n});\r\nroot.get('/', async (ctx) => {\r\n    ctx.body = ` <h1>Working...</h1>`;\r\n});\r\n\r\nexport default root;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/router/root.js","module.exports = require(\"bcrypt-nodejs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcrypt-nodejs\"\n// module id = 16\n// module chunks = 0","import Message from './message';\r\nimport User from './user';\r\n\r\nexport { Message };\r\nexport { User };\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/models/index.js","import mongoose, { Schema } from 'mongoose';\r\nimport bluebird from 'bluebird';\r\nmongoose.Promise = bluebird;\r\n\r\nconst MessageSchema = new Schema({\r\n    user: {\r\n        id: { type: String, required: true },\r\n        username: { type: String, required: true },\r\n    },\r\n    messages: { type: Array },\r\n});\r\n\r\nconst message = mongoose.model('Message', MessageSchema);\r\n\r\nexport default message;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/models/message.js","import mongoose, { Schema } from 'mongoose';\r\nimport bluebird from 'bluebird';\r\n\r\nmongoose.Promise = bluebird;\r\n\r\nconst UserSchema = new Schema({\r\n    username: { type: String, required: true, index: { unique: true } },\r\n    name: { type: String },\r\n    gender: { type: String, required: true },\r\n    image: { type: String },\r\n    age: { type: Number },\r\n    fbid: { type: String },\r\n    email: { type: String, required: true },\r\n    password: { type: String }, // social auth will not have password\r\n});\r\n\r\nconst user = mongoose.model('User', UserSchema);\r\n\r\nexport default user;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/models/user.js","import Router from 'koa-router';\r\nimport koaBody from 'koa-bodyparser';\r\nimport { register, login, fb, check } from '../db/methods';\r\n\r\nconst auth = new Router();\r\n\r\nauth.post('/login', koaBody(), async (ctx) => {\r\n    if (ctx.request.body.username && ctx.request.body.password) {\r\n        await login(ctx.request.body).then((res) => {\r\n            ctx.response.body = res;\r\n        });\r\n    } else {\r\n        ctx.response.body = { success: true, message: 'no enough data!' };\r\n    }\r\n});\r\n\r\nauth.post('/fb', koaBody(), async (ctx) => {\r\n    await fb(ctx.request.body).then((res) => {\r\n        ctx.response.body = res;\r\n    });\r\n});\r\nauth.post('/fbCheck', koaBody(), async (ctx) => {\r\n    await check(ctx.request.body).then((res) => {\r\n        if (res === null) {\r\n            ctx.response.body = true;\r\n        } else {\r\n            ctx.response.body = false;\r\n        }\r\n    });\r\n});\r\n\r\nauth.post('/register', koaBody(), async (ctx) => {\r\n    const { username, password, email, gender, age, image } = ctx.request.body;\r\n    if (username && password && email && gender && age) {\r\n        await register(ctx.request.body).then((res) => {\r\n            ctx.response.body = res;\r\n        });\r\n    } else {\r\n        ctx.response.body = { success: false, message: 'no enough data!' };\r\n    }\r\n});\r\n\r\nexport default auth;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/router/auth.js","import Router from 'koa-router';\r\nimport bodyParser from 'koa-bodyparser';\r\nimport { sendMessage, getMessages } from '../db/methods';\r\n\r\nconst messages = new Router();\r\n\r\nmessages.post('/send', bodyParser(), async (ctx) => {\r\n    await sendMessage(ctx.request.body)\r\n        .then((res) => {\r\n            ctx.response.body = {\r\n                success: res.success,\r\n            };\r\n        })\r\n        .catch((e) => {\r\n            ctx.response.body = e;\r\n        });\r\n});\r\n\r\nmessages.patch('/messages', bodyParser(), async (ctx) => {\r\n    await getMessages(ctx.request.body).then((res) => {\r\n        if (res === null) {\r\n            ctx.response.body = {messages: [], success: true};\r\n        } else {\r\n            ctx.response.body = {messages: res.messages, success: true};\r\n        }\r\n    });\r\n});\r\n\r\nexport default messages;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/router/messages.js","if (process.env.NODE_ENV !== 'production') require('dotenv').config();\r\nimport startDb from '../db/';\r\n\r\nconst { PORT, HOST } = process.env;\r\n\r\nexport default function(app) {\r\n    startDb();\r\n    app.listen(PORT || 8000, () =>\r\n        console.log(`started in http://${HOST}:${PORT}`)\r\n    );\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/start.js","if (process.env.NODE_ENV !== 'production') require('dotenv').config();\r\nimport mongoose from 'mongoose';\r\n\r\nconst { DB_USER, DB_USER_PASS, DB_HOST, DB_PORT, DB_NAME } = process.env;\r\n\r\nexport default function() {\r\n    mongoose.connect(\r\n        `mongodb://${DB_USER}:${DB_USER_PASS}@${DB_HOST}:${DB_PORT}/${DB_NAME}`\r\n    );\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/db/index.js","module.exports = require(\"koa-mount\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-mount\"\n// module id = 24\n// module chunks = 0","import serve from 'koa-static';\r\nimport send from 'koa-send';\r\nimport Koa from 'koa';\r\nimport Router from 'koa-router';\r\nimport path from 'path';\r\n\r\nconst front = new Koa();\r\nconst router = new Router();\r\n\r\nfront.use(serve(path.resolve('static')));\r\nfront.use(router.routes());\r\nfront.use(router.allowedMethods());\r\n\r\nrouter.get('*', async (ctx) => {\r\n    const { url } = ctx;\r\n    switch (url) {\r\n        case '/user/style.css':\r\n            await send(ctx, './static/style.css');\r\n            break;\r\n        case '/user/bundle.js':\r\n            await send(ctx, './static/bundle.js');\r\n            break;\r\n        case '/user/style.css.map':\r\n            await send(ctx, './static/style.css.map');\r\n            break;\r\n        default:\r\n            await send(ctx, './static/index.html');\r\n\r\n            break;\r\n    }\r\n});\r\n\r\nexport default front;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/serveFront.js","module.exports = require(\"koa-static\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-static\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"koa-send\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-send\"\n// module id = 27\n// module chunks = 0"],"sourceRoot":""}